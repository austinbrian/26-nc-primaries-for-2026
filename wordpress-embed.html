<!--
  NC Primary Elections Guide - WordPress Embed Version
  Paste this entire block into a Custom HTML block in WordPress
-->
<div id="nc-primaries-app">
  <style>
    #nc-primaries-app {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      color: #111;
      line-height: 1.5;
      padding: 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    #nc-primaries-app * { box-sizing: border-box; margin: 0; padding: 0; }

    /* Variables as direct values for WP compatibility */
    #nc-primaries-app .controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1rem 0;
      border-bottom: 1px solid #e0e0e0;
      margin-bottom: 2rem;
      background: #fff;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    @media (min-width: 768px) {
      #nc-primaries-app .controls {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }
    }
    #nc-primaries-app .view-modes,
    #nc-primaries-app .type-filters {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.375rem;
    }
    #nc-primaries-app .view-modes { padding-left: 1rem; }
    #nc-primaries-app .type-filters { padding-right: 1rem; }
    #nc-primaries-app .control-label {
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #888;
      margin-right: 0.5rem;
    }
    #nc-primaries-app .view-btn,
    #nc-primaries-app .filter-btn {
      background: #f5f5f5;
      border: 1px solid #e0e0e0;
      color: #4a4a4a;
      padding: 0.4rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 500;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    #nc-primaries-app .view-btn:hover,
    #nc-primaries-app .filter-btn:hover {
      background: #fafafa;
      color: #111;
      border-color: #888;
    }
    #nc-primaries-app .view-btn.active {
      background: #111;
      border-color: #111;
      color: white;
    }
    #nc-primaries-app .filter-btn.active {
      background: #111;
      border-color: #111;
      color: white;
    }
    #nc-primaries-app .filter-btn[data-type="Republican"].active {
      background: #dc2626;
      border-color: #dc2626;
    }
    #nc-primaries-app .filter-btn[data-type="Democratic"].active {
      background: #1d4ed8;
      border-color: #1d4ed8;
    }

    /* Board */
    #nc-primaries-app .board {
      display: grid;
      gap: 1rem;
      padding-bottom: 2rem;
    }
    #nc-primaries-app .board.view-skim { grid-template-columns: 1fr; gap: 0.5rem; }
    #nc-primaries-app .board.view-peek { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
    #nc-primaries-app .board.view-peruse { grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); }
    #nc-primaries-app .board.view-deep-dive { grid-template-columns: 1fr; max-width: 800px; }

    /* Cards */
    #nc-primaries-app .race-card {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    #nc-primaries-app .race-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    #nc-primaries-app .race-card.hidden { display: none; }
    #nc-primaries-app .race-card.party-republican { border-left: 4px solid #dc2626; }
    #nc-primaries-app .race-card.party-democratic { border-left: 4px solid #1d4ed8; }

    /* Skim view */
    #nc-primaries-app .view-skim .race-card {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      gap: 1rem;
    }
    #nc-primaries-app .view-skim .card-rank {
      font-size: 1.125rem;
      font-weight: 700;
      color: #888;
      min-width: 2rem;
    }
    #nc-primaries-app .view-skim .card-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex: 1;
      flex-wrap: wrap;
    }
    #nc-primaries-app .view-skim .card-title {
      font-size: 0.9375rem;
      font-weight: 600;
    }
    #nc-primaries-app .view-skim .card-party {
      padding: 0.15rem 0.4rem;
      border-radius: 3px;
      font-size: 0.625rem;
      font-weight: 700;
      text-transform: uppercase;
    }
    #nc-primaries-app .view-skim .card-party.republican { background: #fef2f2; color: #dc2626; }
    #nc-primaries-app .view-skim .card-party.democratic { background: #eff6ff; color: #1d4ed8; }
    #nc-primaries-app .view-skim .card-type,
    #nc-primaries-app .view-skim .card-location,
    #nc-primaries-app .view-skim .card-candidates,
    #nc-primaries-app .view-skim .card-summary,
    #nc-primaries-app .view-skim .card-stakes,
    #nc-primaries-app .view-skim .card-issues,
    #nc-primaries-app .view-skim .card-keyfact { display: none; }

    /* Peek view */
    #nc-primaries-app .view-peek .race-card { padding: 1.25rem; }
    #nc-primaries-app .view-peek .card-header {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }
    #nc-primaries-app .view-peek .card-rank {
      font-size: 1.25rem;
      font-weight: 700;
      color: #888;
    }
    #nc-primaries-app .view-peek .card-title {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 0.375rem;
    }
    #nc-primaries-app .view-peek .card-meta {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    #nc-primaries-app .view-peek .card-party {
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      font-size: 0.6875rem;
      font-weight: 700;
      text-transform: uppercase;
    }
    #nc-primaries-app .view-peek .card-party.republican { background: #fef2f2; color: #dc2626; }
    #nc-primaries-app .view-peek .card-party.democratic { background: #eff6ff; color: #1d4ed8; }
    #nc-primaries-app .view-peek .card-type { font-size: 0.75rem; color: #888; }
    #nc-primaries-app .view-peek .card-location { font-size: 0.75rem; color: #4a4a4a; }
    #nc-primaries-app .view-peek .card-candidates { margin-top: 0.75rem; }
    #nc-primaries-app .view-peek .candidate {
      display: flex;
      align-items: baseline;
      gap: 0.5rem;
      padding: 0.2rem 0;
      font-size: 0.8125rem;
    }
    #nc-primaries-app .view-peek .candidate-name { font-weight: 600; }
    #nc-primaries-app .view-peek .candidate-role { font-size: 0.6875rem; color: #888; }
    #nc-primaries-app .view-peek .card-summary,
    #nc-primaries-app .view-peek .card-stakes,
    #nc-primaries-app .view-peek .card-issues,
    #nc-primaries-app .view-peek .card-keyfact { display: none; }

    /* Expanded cards */
    #nc-primaries-app .race-card.expanded {
      grid-column: 1 / -1 !important;
      max-width: 800px;
    }
    #nc-primaries-app .race-card.expanded-deep-dive { padding: 2rem; }
    #nc-primaries-app .race-card.expanded-deep-dive .card-header {
      display: flex;
      align-items: flex-start;
      gap: 1.25rem;
      margin-bottom: 1.25rem;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .card-rank {
      font-size: 2rem;
      font-weight: 700;
      color: #888;
      min-width: 3rem;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .card-title {
      font-size: 1.375rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .card-meta {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .card-party {
      display: inline-block;
      padding: 0.25rem 0.6rem;
      border-radius: 3px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .card-type { font-size: 0.875rem; color: #888; }
    #nc-primaries-app .race-card.expanded-deep-dive .card-location { font-size: 0.875rem; color: #4a4a4a; }
    #nc-primaries-app .race-card.expanded-deep-dive .card-candidates {
      display: grid !important;
      margin: 1.25rem 0;
      gap: 0.625rem;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .candidate {
      padding: 0.875rem;
      background: #f5f5f5;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .candidate-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.375rem;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .candidate-name { font-weight: 700; }
    #nc-primaries-app .race-card.expanded-deep-dive .candidate-role {
      font-size: 0.6875rem;
      color: white;
      padding: 0.15rem 0.4rem;
      border-radius: 3px;
      background: #888;
    }
    #nc-primaries-app .race-card.expanded-deep-dive.party-republican .candidate-role.incumbent,
    #nc-primaries-app .race-card.expanded-deep-dive.party-republican .candidate-role.appointed { background: #991b1b; }
    #nc-primaries-app .race-card.expanded-deep-dive.party-republican .candidate-role.challenger,
    #nc-primaries-app .race-card.expanded-deep-dive.party-republican .candidate-role.candidate,
    #nc-primaries-app .race-card.expanded-deep-dive.party-republican .candidate-role.frontrunner { background: #f87171; color: #991b1b; }
    #nc-primaries-app .race-card.expanded-deep-dive.party-democratic .candidate-role.incumbent,
    #nc-primaries-app .race-card.expanded-deep-dive.party-democratic .candidate-role.appointed { background: #1e3a8a; }
    #nc-primaries-app .race-card.expanded-deep-dive.party-democratic .candidate-role.challenger,
    #nc-primaries-app .race-card.expanded-deep-dive.party-democratic .candidate-role.candidate,
    #nc-primaries-app .race-card.expanded-deep-dive.party-democratic .candidate-role.frontrunner { background: #60a5fa; color: #1e3a8a; }
    #nc-primaries-app .race-card.expanded-deep-dive .candidate-desc {
      display: block !important;
      font-size: 0.8125rem;
      color: #4a4a4a;
      font-family: Georgia, serif;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .card-summary {
      display: block !important;
      font-size: 1rem;
      color: #4a4a4a;
      line-height: 1.7;
      margin-bottom: 1rem;
      font-family: Georgia, serif;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .card-stakes {
      display: block !important;
      font-size: 0.9375rem;
      padding: 0.875rem 1rem;
      background: #fefce8;
      border-left: 4px solid #eab308;
      border-radius: 0 6px 6px 0;
      margin-bottom: 1rem;
      font-family: Georgia, serif;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .card-stakes-label {
      display: block !important;
      font-size: 0.6875rem;
      font-weight: 700;
      text-transform: uppercase;
      color: #a16207;
      margin-bottom: 0.25rem;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .card-issues {
      display: flex !important;
      flex-wrap: wrap;
      gap: 0.375rem;
      margin-bottom: 1rem;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .issue-tag {
      display: inline-block !important;
      background: #f5f5f5;
      border: 1px solid #e0e0e0;
      padding: 0.3rem 0.6rem;
      border-radius: 16px;
      font-size: 0.75rem;
      color: #4a4a4a;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .card-keyfact {
      display: block !important;
      font-size: 0.9375rem;
      padding: 0.875rem 1rem;
      background: #f5f5f5;
      border-left: 4px solid #ff584e;
      border-radius: 0 6px 6px 0;
      font-family: Georgia, serif;
    }
    #nc-primaries-app .race-card.expanded-deep-dive .card-keyfact-label {
      display: block !important;
      font-size: 0.6875rem;
      font-weight: 700;
      text-transform: uppercase;
      color: #ff584e;
      margin-bottom: 0.25rem;
    }
  </style>

  <nav class="controls">
    <div class="view-modes">
      <span class="control-label">View:</span>
      <button class="view-btn" data-view="skim">Races</button>
      <button class="view-btn active" data-view="peek">Matchups</button>
      <button class="view-btn" data-view="peruse">Peruse</button>
      <button class="view-btn" data-view="deep-dive">Deep Dive</button>
    </div>
    <div class="type-filters">
      <span class="control-label">Filter:</span>
      <button class="filter-btn active" data-type="ALL">All</button>
      <button class="filter-btn" data-type="Republican">GOP</button>
      <button class="filter-btn" data-type="Democratic">Dem</button>
      <button class="filter-btn" data-type="U.S. House">US House</button>
      <button class="filter-btn" data-type="U.S. Senate">US Senate</button>
      <button class="filter-btn" data-type="State Senate">NC Senate</button>
      <button class="filter-btn" data-type="State House">NC House</button>
      <button class="filter-btn" data-type="Judicial">Judicial</button>
    </div>
  </nav>

  <main class="board view-peek" id="nc-primaries-board"></main>

  <script>
  (function() {
    const DATA_URL = 'https://raw.githubusercontent.com/YOUR_USERNAME/matchup-guide/main/races.json';

    let races = [];
    let currentView = 'peek';
    let currentFilter = 'ALL';

    const board = document.getElementById('nc-primaries-board');
    const container = document.getElementById('nc-primaries-app');
    const viewBtns = container.querySelectorAll('.view-btn');
    const filterBtns = container.querySelectorAll('.filter-btn');

    function matchesFilter(race, filter) {
      if (filter === 'ALL') return true;
      return race.party === filter || race.type === filter;
    }

    function getRoleClass(role) {
      const r = role.toLowerCase();
      if (r.includes('incumbent')) return 'incumbent';
      if (r.includes('appointed')) return 'appointed';
      if (r.includes('frontrunner')) return 'frontrunner';
      if (r.includes('challenger')) return 'challenger';
      return 'candidate';
    }

    function getExpandedView() {
      return currentView === 'skim' ? 'expanded-peruse' : 'expanded-deep-dive';
    }

    function createCard(race) {
      const hidden = !matchesFilter(race, currentFilter);
      const party = race.party.toLowerCase();
      const candidates = race.candidates.map(c => `
        <div class="candidate">
          <div class="candidate-header">
            <span class="candidate-name">${c.name}</span>
            <span class="candidate-role ${getRoleClass(c.role)}">${c.role}</span>
          </div>
          <p class="candidate-desc">${c.description}</p>
        </div>
      `).join('');
      const issues = race.keyIssues.map(i => `<span class="issue-tag">${i}</span>`).join('');

      return `
        <article class="race-card party-${party} ${hidden ? 'hidden' : ''}" data-party="${race.party}" data-type="${race.type}" data-rank="${race.rank}">
          <div class="card-header">
            <span class="card-rank">${race.rank}</span>
            <div class="card-info">
              <h3 class="card-title">${race.title}</h3>
              <div class="card-meta">
                <span class="card-party ${party}">${race.party}</span>
                <span class="card-type">${race.type}</span>
              </div>
              <div class="card-location">${race.location}</div>
            </div>
          </div>
          <div class="card-candidates">${candidates}</div>
          <p class="card-summary">${race.summary}</p>
          <div class="card-stakes">
            <div class="card-stakes-label">Why It Matters</div>
            ${race.stakes}
          </div>
          <div class="card-issues">${issues}</div>
          <div class="card-keyfact">
            <div class="card-keyfact-label">Key Fact</div>
            ${race.keyFact}
          </div>
        </article>
      `;
    }

    function render() {
      board.className = 'board view-' + currentView;
      board.innerHTML = races.map(createCard).join('');
    }

    function setView(view) {
      currentView = view;
      viewBtns.forEach(b => b.classList.toggle('active', b.dataset.view === view));
      render();
    }

    function setFilter(filter) {
      currentFilter = filter;
      filterBtns.forEach(b => b.classList.toggle('active', b.dataset.type === filter));
      board.querySelectorAll('.race-card').forEach(card => {
        const visible = matchesFilter({ party: card.dataset.party, type: card.dataset.type }, filter);
        card.classList.toggle('hidden', !visible);
      });
    }

    viewBtns.forEach(b => b.addEventListener('click', () => setView(b.dataset.view)));
    filterBtns.forEach(b => b.addEventListener('click', () => setFilter(b.dataset.type)));

    board.addEventListener('click', function(e) {
      const card = e.target.closest('.race-card');
      if (!card) return;
      const cls = getExpandedView();
      if (card.classList.contains('expanded')) {
        card.classList.remove('expanded', 'expanded-peruse', 'expanded-deep-dive');
        return;
      }
      const prev = board.querySelector('.race-card.expanded');
      if (prev) prev.classList.remove('expanded', 'expanded-peruse', 'expanded-deep-dive');
      card.classList.add('expanded', cls);
      setTimeout(() => card.scrollIntoView({ behavior: 'smooth', block: 'start' }), 50);
    });

    fetch(DATA_URL + '?v=' + Date.now())
      .then(r => r.json())
      .then(data => { races = data.races; render(); })
      .catch(err => { board.innerHTML = '<p>Error loading data.</p>'; console.error(err); });
  })();
  </script>
</div>
